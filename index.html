<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Master Speech</title>
    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="javascripts/respond.js"></script>
    <script src="https://www.java.com/js/deployJava.js"></script>
    <script src="js/masterspeech.js"></script>
    <script src="js/lib/diff.js"></script>
    <script src="js/lib/recorderjs/recorder.js"></script>
    
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <!--[if lt IE 8]>
    <link rel="stylesheet" href="stylesheets/ie.css">
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
	<script src="js/vendor/modernizr.js"></script>


  </head>
  <body>
      

    <div class="wrapper">

      <section>
        <div id="title">
          <h1>Master Speech</h1>
          <p></p>
          <hr>
          <center><span>An easy, intuitive way to practice your speech or presentation.</span></center>
        </div>

        <h3>

	<div id="myModal" class="reveal-modal" data-reveal aria-labelledby="myModal" aria-hidden="true" role="dialog">
		<h2 id="confmsg">Great job!</h2>
		<p id="tip" class="lead"></p>
		<p id="time"></p>
		<p id="words"></p>
		<p id="fillers"></p>
		<p id="wpm"></p>
		<audio controls>
		  <br> <br> <br>
		  </audio>
		<a  href="#" class="close-reveal-modal" onclick = "closemod()">x</a>
	</div>
	
	<div id="procmodal" class="reveal-modal" data-reveal aria-labelledby="procmodal" aria-hidden="true" role="dialog">
		<h2 id="modalTitle">Processing...</h2>
		<p class="lead">Please wait.</p>
	</div>
	<br><br>
	<center> <a  href="#" id="baton" class="button" onclick = "batonscript()"><img src="images/mic_off.jpg"/></a> </center>
	
	<br><br><br><br>

		
		
    <script type="text/javascript">
    var but = document.getElementById("baton")
	var badwrds = ["um", "uh", "stuff", "thing", "things", "yeah"]
	
	function batonscript()
    {
    
		if (but.text == "Record" ){
		console.log("here")
    but.text = "Stop";
        start_recording(function(final_transcript, interim_transcript) {
    console.log(final_transcript + interim_transcript);
    }, revmod);

    } else {
	console.log("there");
    but.text = "Record";
    processing();
        stop_recording();
    }
		
	}
	
    function processing(){
    $("#procmodal").foundation('reveal', 'open');
    
    //stuff happens then revmod
    }
	
    function revmod(final_transcript, time, confidence){
	console.log("tiny tim:" + time)
		$("#procmodal").trigger("reveal:close"); 
		$("#myModal").foundation('reveal', 'open');
		var st = stats( processData(final_transcript,time));
		var tip = "You blew us away!"
		console.log( confidence)
		if( confidence < .81 )
			tip = "You were difficult to understand.  Speak clearly and make sure there is no background noise.";
		else if ( st.wpm > 140 )
			tip = "Slow down!  Nobody understood you.";
		else if (st.wpm < 100 )
			tip = "Your pacing was a little slow.";
		else if (st.fills > 2 )
			tip = "Try to use less filler words (such as \""+(st.filllist)[0]+"\").";
		document.getElementById("tip").innerHTML = tip;
		//conf message
		//tip
		document.getElementById("time").innerHTML = "Time: "+(st.time/1000)+" seconds.";
		document.getElementById("words").innerHTML = "Words: "+st.words;
		document.getElementById("fillers").innerHTML = "Filler Words Per Minute: "+st.fills;
		document.getElementById("wpm").innerHTML = "Words per minute: "+st.wpm;
    }
	
    function closemod(){
        location.reload();
    }

    function changeImage()
    {
      document.images["jsbutton"].src = upImage.src;
      return true;
    }
    function changeImageBack()
    {
      document.images["jsbutton"].src = normalImage.src;
      return true;
    }
	
	function processData(text, tim)
	{
	  var proc = {time:tim, trans:text, words:0, fills:[] }
	  var spl = text.split(" ");
	  spl.forEach(function(x) {
		console.log( x )
		proc.words++;
		badwrds.forEach(function(y) {
			if (x == y)
				proc.fills.push( x );
		
	  })
	  })
	  return proc;
	}
	
	function stats( proc )
	{
		var st = { time:proc.time, words:proc.words, fills:(proc.fills.length / proc.time * (60000.0)), wpm: (proc.words / proc.time * (60000.0)), filllist:proc.fills };
		console.log(st.filllist);
		return st;
	}
    function handleMDown()
    {
     document.images["jsbutton"].src = upImage.src;
     return true;
    }
    function handleMUp()
    {
     changeImage();
     return true;
    }
	</script>
</center>

<h3>
<a id="Contact" class="anchor" href="#support-or-contact" aria-hidden="true"><span class="octicon octicon-link"></span></a>Support or Contact</h3>

<p>For help and support, please email us <a href="mailto:arealemail@arealemailwebsite.real"> here.</a></p>
      </section>

    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
	<script src="js/vendor/jquery.js"></script>	
	<script src="js/foundation.min.js"></script>
    <script>
	
  </script>
  </body>
</html>
